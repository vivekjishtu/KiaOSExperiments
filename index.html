<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>KiaOS Experiments</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
	   section button {
		width: 100%;   
		font-size: 24pt;
	    }
	    
	    section {
		margin-bottom: 10px;    
	    }
    </style>
</head>
  <body>
     <main>
      <section>
        <button id="launchHotSpot">Hotspot</button>
      </section>
      <section>
        <button id="launchDeveloperMode">DevMode</button>
      </section>
      <section>
        <button id="launchCamera">Camera</button>
      </section>
      <section>
        <button id="launchTest">Testing</button>
      </section>
      <section id="image-presenter"></section>
    </main>
    <script>
	    
      function privilegedFactoryReset() {
	try {
	  navigator.mozPower.factoryReset('root');
	} catch(ex) {
	  alert(ex);	
	}
      }
	   
     function openCamera() {
	var pick = new MozActivity({
	   name: "pick",
	   data: {
	       type: ["image/png", "image/jpg", "image/jpeg"]
	   }
	});
	
	pick.onsuccess = function () {
	    // Create image and set the returned blob as the src
	    var img = document.createElement("img");
	    img.src = window.URL.createObjectURL(this.result.blob);

	    // Present that image in your app
	    var imagePresenter = document.querySelector("#image-presenter");
	    imagePresenter.appendChild(img);
	};

	pick.onerror = function () {
	    // If an error occurred or the user canceled the activity
	    alert("Can't view the image!");
	};
     }
	    
     document.getElementById('launchCamera').addEventListener('click', function() {
          try {
	     openCamera();
	  }
          catch(e) {
            alert(e)
          }
      }, false);
	    
      function testFun() {
        var masterExt = navigator.engmodeExtension || navigator.jrdExtension || navigator.kaiosExtension;
	   
	  try {
         //   var port = masterExt.getPropertyValue('service.adb.tcp.port');
          //  alert("Port: " + port);
		  
		let executor = masterExt.startUniversalCommand('ls', true)
		executor.onsuccess = function(){ alert("Success");/*your success handler*/}
		executor.onerror = function(){ alert("Error"); /*your error handler*/}
	  }
          catch(e) {
            alert(e)
          }
        //alert(masterExt);
      }
      
      document.getElementById('launchTest').addEventListener('click', function() {
         testFun("ls");
      }, false);
	    
      document.getElementById('launchDeveloperMode').addEventListener('click', function() {
         if(window.MozActivity) {
            var act = new MozActivity({
              name: "configure",
              data: {
                target: "device",
                section: "developer"
              }
            });
            
            console.log(act);
          } else {
           window.alert('Open the page from the device.')
         }
      }, false);
      
      document.getElementById('launchHotSpot').addEventListener('click', function(e)      {
        if(window.MozActivity) {
          var act = new MozActivity({
            name: "configure",
            data: {
              target: "device",
              section: "hotspot"
            }
          });
          console.log(act);
        } else {
          window.alert('Open the page from the device.')
        }
      }, false)
    </script>

</body>
</html>
